# Семинар по NFR

Работал в команде с Шелковым А.М.

## Таблица реестра

| ID      | User Story / Feature                    | Category              | Requirement (NFR)                                                                                                  | Rationale / Risk                       | Acceptance (G-W-T)                                                                                                                                                                  | Evidence (test/log/scan/policy)                        | Trace (issue/link) | Owner    | Status      | Priority    | Severity      | Tags             |
| ------- | --------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------------------------ | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------ | ------------------ | -------- | ----------- | ----------- | ------------- | ---------------- |
| NFR-001 | As a user I upload avatar | Security-InputValidation | Reject payloads >1 MiB; MIME из allowlist; **extra** поля запрещены | Защита от DoS/грязных входных данных | **Given** тело 2 MiB и неизвестные поля<br>**When** POST `/api/files/avatar`<br>**Then** 413 с RFC7807 + запрет extra | test: `e2e-upload-limit`; policy: schema/size | #123               | team-a | Proposed | P2 - Medium | S2 - Major | limits,validation |
| NFR-002 | As a client I call /api/* | Performance              | P95 ≤ 300 ms при 50 RPS в течение 5 мин                             | UX/SLO                               | **Given** сервис здоров<br>**When** 50 RPS на `/api/*` 5 минут<br>**Then** P95 ≤ 300 ms; error rate ≤ 1%              | test: `load-50rps`; log: latency quantiles    | #124               | team-a | Draft    | P1 - High   | S2 - Major | perf,slo          |
| NFR-003 | As a user I update my profile           | Security-AuthN        | POST `/api/profile` требует валидный JWT токен; некорректный/истекший токен возвращает 401.                        | Базовая защита write-операций          | **Given** истекший JWT<br>**When** POST `/api/profile`<br>**Then** ответ 401 Unauthorized                                                                                           | test: `integration-authn-profile`                      | #125               | team-b   | Proposed    | P1 - High   | S1 - Critical | security,authn   |
| NFR-004 | As a user I view my order history       | Security-AuthZ/RBAC   | Пользователь `user-A` не может читать заказы пользователя `user-B` через GET `/api/orders/{orderId}`.              | Изоляция данных пользователей          | **Given** пользователь `user-A` аутентифицирован<br>**When** он запрашивает GET `/api/orders/{orderId_B}`<br>**Then** ответ 404 Not Found                                           | test: `authz-order-isolation`                          | #126               | team-b   | Proposed    | P1 - High   | S1 - Critical | security,authz   |
| NFR-005 | As a user I try to login                | RateLimiting          | Эндпоинт POST `/api/login` ограничен 10 попытками в минуту с одного IP. Превышение возвращает 429.                 | Защита от brute-force атак             | **Given** с одного IP сделано 10 запросов<br>**When** выполняется 11-й запрос к `/api/login` за 60с<br>**Then** ответ 429 и заголовок `Retry-After`                                 | test: `e2e-login-ratelimit`; metric: `http_429_total`  | #127               | team-a   | Approved    | P1 - High   | S1 - Critical | security,dos     |
| NFR-006 | As a developer I debug a failed payment | Observability/Logging | Все запросы к API логируются в JSON и содержат сквозной `X-Correlation-ID`.                                        | Трассировка и расследование инцидентов | **Given** запрос с `X-Correlation-ID=abc-123`<br>**When** он проходит через API Gateway и Payment Service<br>**Then** в логах обоих сервисов есть запись с `correlation_id=abc-123` | log: `json-pattern`; query: `search-by-correlation-id` | #128               | platform | Implemented | P2 - Medium | S2 - Major    | logging,ops      |
| NFR-007 | As a user I register a new account      | Privacy/PII           | Email и телефон пользователя маскируются в логах. Данные по заказам анонимизируются через 90 дней.                 | Защита ПДн и GDPR/комплаенс            | **Given** запрос на регистрацию с email<br>**When** событие логируется<br>**Then** в логе поле email маскировано; задача ретенции удаляет заказ >90 дней                            | log: `redacted-email`; policy: `retention-policy-90d`  | #129               | team-b   | Proposed    | P1 - High   | S2 - Major    | privacy,gdpr     |
| NFR-008 | As a developer I connect to the DB      | Security-Secrets      | В репозитории и его истории отсутствуют секреты (ключи API, пароли). Они загружаются в рантайме из Secret Manager. | Предотвращение утечки ключей через код | **Given** репозиторий<br>**When** выполняется `gitleaks scan`<br>**Then** результат '0 findings'                                                                                    | scan: `secret-scan-ci-report`                          | #130               | platform | Implemented | P1 - High   | S1 - Critical | security,secrets |
| NFR-009 | As an admin I change a user's role      | Auditability          | Смена роли пользователя через админ-панель создает неизменяемое audit-событие (кто, кому, какую роль, когда).      | Расследование инцидентов, комплаенс    | **Given** admin `A` меняет роль юзера `B`<br>**When** операция успешна<br>**Then** в audit-логе появляется запись: `actor=A, target=B, action=change_role`                          | log: `audit-event-example`                             | #131               | team-b   | Proposed    | P2 - Medium | S2 - Major    | audit,security   |
| NFR-010 | As a DevOps I deploy the application    | Container/Runtime     | Контейнер приложения запускается от пользователя `appuser` (не root) с read-only файловой системой.                | Снижение поверхности атаки при RCE     | **Given** контейнер запущен<br>**When** проверяется `docker inspect`<br>**Then** `User=appuser` и `ReadonlyRootfs=true`                                                             | policy: `Dockerfile`; scan: `trivy-config-scan`        | #132               | platform | Approved    | P2 - Medium | S2 - Major    | security,infra   |